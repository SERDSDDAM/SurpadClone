### **ملحق (أ): دليل التطوير التفصيلي لخدمة القرار المساحي**

**الإصدار:** 3.0 (متكامل مع المنصة)
**التاريخ:** 3 أغسطس 2025
**المؤلف:** Manus AI

---




## 1. المقدمة التنفيذية: تكامل خدمة القرار المساحي ضمن رؤية "بنّاء اليمن"

### 1.1. الغرض من هذا الملحق

يمثل هذا الملحق، "دليل التطوير التفصيلي لخدمة القرار المساحي"، وثيقة حيوية تكمّل وتتكامل مع "دليل التطوير الشامل لمنصة بنّاء اليمن الرقمية (الإصدار 2.0)" [1]. بينما يقدم الدليل الشامل رؤية معمارية عليا للمنصة ككل، يغوص هذا الملحق في التفاصيل التقنية والوظيفية الدقيقة لخدمة "القرار المساحي"، التي تُعد إحدى الخدمات المحورية في المرحلة الأولى من تطوير المنصة. الهدف هو توفير خارطة طريق تنفيذية مفصلة لفرق التطوير، تضمن بناء خدمة قوية، دقيقة، ومتكاملة، تلبي أعلى معايير الجودة والكفاءة، وتساهم بفعالية في تحقيق الأهداف الاستراتيجية لمنصة "بنّاء اليمن".

### 1.2. الأهداف الاستراتيجية لخدمة القرار المساحي ضمن سياق المنصة

تُصمم خدمة القرار المساحي لتحقيق الأهداف التالية، بما يتماشى مع الرؤية الأوسع لمنصة "بنّاء اليمن":

1.  **الأتمتة الشاملة والدقيقة:** تحويل عملية إصدار القرار المساحي من إجراء يدوي إلى سير عمل رقمي مؤتمت بالكامل، بدءًا من تقديم الطلب وحتى إصداره، مع ضمان دقة متناهية في البيانات الجغرافية المستخلصة من المصادر الميدانية الموثوقة [2].
2.  **الاعتماد على البيانات الميدانية الموثوقة:** فرض استخدام أجهزة GNSS عالية الدقة كمصدر إلزامي للبيانات المساحية، مما يضمن موثوقية البيانات ويقلل من الأخطاء البشرية، ويدعم بناء قاعدة بيانات جغرافية وطنية موثوقة [3].
3.  **تحسين الكفاءة التشغيلية:** تقليص زمن دورة العمل بشكل جذري من خلال تبسيط الإجراءات، أتمتة الحسابات الهندسية، وتوفير أدوات ذكية للمساحين والمراجعين، مما يساهم في تحسين مؤشرات الأداء الرئيسية (KPIs) للمنصة ككل [4].
4.  **بناء الأصول الرقمية الجغرافية:** تحويل كل عملية مسح ميداني إلى مساهمة فعالة في بناء وتحديث قاعدة بيانات جغرافية مكانية (Spatial Database) شاملة ودقيقة لليمن، بما في ذلك رقمنة وحدات الجوار والشوارع غير المخططة، مما يدعم التخطيط العمراني المستقبلي [5].
5.  **الامتثال القانوني الذكي:** ضمان توافق جميع مخرجات الخدمة (القرارات المساحية) مع قانون البناء اليمني ولائحته التنفيذية [6]، من خلال تطبيق قواعد عمل مبرمجة تتحقق من الاشتراطات والمعايير الفنية.
6.  **الشفافية والمساءلة:** توفير تتبع كامل لحالة الطلب وسجل الإجراءات المتخذة من قبل جميع الأطراف المعنية، مما يعزز الشفافية ويحد من أي ممارسات غير سليمة.

### 1.3. موقع خدمة القرار المساحي في خارطة طريق "بنّاء اليمن"

تُعد خدمة القرار المساحي إحدى الخدمات الأساسية ضمن "المرحلة الأولى: التأسيس والامتثال القانوني" من خارطة طريق تطوير منصة "بنّاء اليمن" [1]. هذا يعني أنها ستكون من أوائل الخدمات التي يتم إطلاقها بشكل كامل، وستشكل الأساس للعديد من الخدمات اللاحقة مثل رخص البناء، حيث أن القرار المساحي هو متطلب إلزامي لإصدار أي رخصة بناء. هذا التكامل يضمن ترابط الخدمات وتدفق البيانات بسلاسة عبر المنصة.

[1] دليل التطوير الشامل لمنصة "بنّاء اليمن" الرقمية (الإصدار 2.0). (مرفق سابقاً)
[2] الأتمتة والدقة في الخدمات الحكومية الرقمية. (مرجع افتراضي)
[3] أهمية GNSS في المسح العقاري الحديث. (مرجع افتراضي)
[4] تحسين الكفاءة التشغيلية في القطاع العام. (مرجع افتراضي)
[5] بناء قواعد البيانات الجغرافية الوطنية. (مرجع افتراضي)
[6] قانون البناء اليمني رقم (19) لسنة 2002م ولائحته التنفيذية. (مرجع افتراضي)



## 2. رحلة المتعامل (User Journey) لخدمة القرار المساحي: تجربة رقمية متكاملة

تم تصميم رحلة المتعامل لتكون سلسة، شفافة، وموجهة، مقسمة إلى خطوات واضحة لضمان تجربة مستخدم مثالية. هذه الرحلة مستوحاة من أفضل الممارسات في المنصات الحكومية الرقمية وتأخذ في الاعتبار خصوصية العمل المساحي.

### 2.1. تقديم الطلب (بوابة المواطن/المكتب الهندسي)

1.  **تسجيل الدخول:** يقوم المواطن أو المكتب الهندسي (نيابة عن المواطن) بتسجيل الدخول إلى بوابة "بنّاء اليمن" الرقمية باستخدام بيانات اعتماده.
2.  **اختيار الخدمة:** من قائمة الخدمات المتاحة، يختار المستخدم "خدمة إصدار قرار مساحي".
3.  **تعبئة بيانات الطلب الأساسية:**
    *   **بيانات المالك:** الاسم، رقم الهوية، معلومات الاتصال.
    *   **بيانات العقار:** المحافظة، المديرية، المنطقة، رقم المربع/القطعة (إن وجد).
    *   **الغرض من القرار المساحي:** (مثال: إصدار رخصة بناء، تقسيم أرض، تسوية نزاع).
    *   **نوع الملكية:** (مثال: صك شرعي، عقد بيع، حيازة).
4.  **رفع المستندات الأولية:** يطلب النظام رفع صور واضحة للمستندات الأساسية مثل وثيقة الملكية (الصك الشرعي أو ما يعادله) وصورة من البطاقة الشخصية للمالك.
5.  **تأكيد الطلب:** يقوم المستخدم بمراجعة البيانات المدخلة وتأكيد الطلب. يقوم النظام بتوليد رقم طلب فريد وإرسال إشعار للمستخدم.

### 2.2. المراجعة الأولية وتحديد موعد المساحة (مكتب الأشغال)

1.  **استلام الطلب:** يتلقى موظف الاستقبال أو المراجع المختص في مكتب الأشغال إشعاراً بوجود طلب قرار مساحي جديد.
2.  **التدقيق المبدئي:** يقوم الموظف بمراجعة المستندات الأولية للتأكد من اكتمالها وصحتها الظاهرية.
3.  **تحديد المساح الميداني:** يقوم النظام تلقائياً (أو يدوياً من قبل المدير) بتعيين الطلب لمساح ميداني مؤهل بناءً على المنطقة الجغرافية أو حجم العمل.
4.  **تحديد موعد المساحة:** يتم التواصل مع مقدم الطلب لتحديد موعد مناسب للرفع المساحي الميداني. يتم تسجيل الموعد في النظام وإرسال إشعار للمساح والمواطن.

### 2.3. الرفع المساحي الميداني (تطبيق المفتش المساحي - التكامل مع GNSS)

هذه هي المرحلة الأكثر أهمية وتتضمن التكامل المباشر مع أجهزة GNSS والتكويد الذكي للمعالم.

1.  **استلام التكليف:** يتلقى المساح الميداني التكليف الجديد على تطبيق "بنّاء المساحي" على جهازه اللوحي أو هاتفه الذكي.
2.  **التوجه للموقع:** يستخدم المساح خرائط التطبيق للوصول إلى الموقع المحدد.
3.  **الاتصال بجهاز GNSS:** يقوم المساح بتوصيل جهازه اللوحي/الهاتف الذكي بجهاز GNSS عالي الدقة (مثل Stonex) عبر البلوتوث. يعرض التطبيق حالة الاتصال ودقة الإحداثيات.
4.  **بدء الرفع المساحي الموجه (Guided Survey):**
    *   يعرض التطبيق خريطة للموقع مع إحداثيات المساح الحالية.
    *   يقوم المساح بتحديد نوع المعلم الذي سيبدأ برفعه (نقطة، خط، مضلع) من شريط الأدوات الذكي.
    *   **التكويد الذكي للمعالم (Intelligent Feature Coding):**
        *   **اختيار نوع المعلم:** يختار المساح من الأزرار المخصصة: `نقطة`، `خط`، `مضلع`.
        *   **إذا اختار `نقطة`:**
            *   تظهر قائمة منسدلة بأكواد النقاط المحددة مسبقًا (مثال: `عمود إنارة`, `شجرة`, `ركن مبنى`).
            *   يختار الكود المناسب ويضغط على زر "رفع".
            *   يتم تسجيل إحداثيات GNSS الحالية وربطها بالكود، وتظهر النقطة على الخريطة.
        *   **إذا اختار `خط`:**
            *   تظهر قائمة بأكواد الخطوط (مثال: `رصيف`, `ضلع مبنى`, `سور`, `خط كهرباء`). يختار النوع (مثلاً: `سور`).
            *   **تحديد نقطة البداية الذكية:** يسأل التطبيق: "نقطة بداية السور؟" مع خيارين:
                *   **النقطة الحالية:** يستخدم إحداثيات GNSS الحالية.
                *   **اختر من الخريطة:** يسمح بالنقر على نقطة تم رفعها مسبقًا لربط الخطوط ببعضها (Snapping).
            *   **الاستمرار في الرفع:** يدخل التطبيق في "وضع رسم الخط". يتحرك المساح ويضغط على "إضافة نقطة" لكل نقطة على طول الخط. يتم رسم الخط تلقائياً على الخريطة.
            *   **إنهاء الخط:** عند الانتهاء، يختار المساح "إنهاء الخط" لحفظ الخط كمعلم مكتمل.
        *   **إذا اختار `مضلع`:**
            *   تظهر قائمة بأكواد المضلعات (مثال: `مبنى`, `أرض فضاء`, `مساحة زراعية`, `عريم`, `صبابة`, `سور`). يختار النوع (مثلاً: `مبنى`).
            *   **تحديد نقطة البداية الذكية:** يسأل التطبيق: "نقطة بداية المبنى؟" مع خيارين:
                *   **النقطة الحالية:** يستخدم إحداثيات GNSS الحالية.
                *   **اختر من الخريطة / استكمل مضلعًا سابقًا:** يسمح باختيار نقطة بداية جديدة، أو استكمال مضلع غير مكتمل سابقًا.
            *   **الاستمرار في الرفع:** يدخل التطبيق في "وضع رسم المضلع". يضيف المساح نقاط أركان المضلع، ويتم تحديث شكل المضلع على الخريطة.
            *   **إنهاء المضلع الذكي:** عند الانتهاء، تظهر خيارات:
                *   **نقطة نهاية (وإبقاء المضلع مفتوحًا):** يحفظ النقطة الحالية كنهاية مؤقتة، ويحفظ المضلع بحالة "قيد التقدم". يسمح باستكماله لاحقًا.
                *   **نقطة إغلاق (وربطها بالبداية):** يغلق المضلع تلقائيًا بربط النقطة الأخيرة بنقطة البداية، ويحفظه بحالة "مكتمل".
5.  **إضافة الملاحظات والصور:** يمكن للمساح إضافة ملاحظات نصية وصور فوتوغرافية للمعالم المرفوعة لدعم البيانات.
6.  **مزامنة البيانات:** يقوم التطبيق بمزامنة البيانات المرفوعة (النقاط، الخطوط، المضلعات، الصور، الملاحظات) تلقائياً مع الواجهة الخلفية للمنصة بمجرد توفر الاتصال بالإنترنت. يدعم التطبيق العمل دون اتصال بالإنترنت ومزامنة البيانات لاحقاً.

### 2.4. معالجة البيانات وإصدار القرار المساحي (مكتب الأشغال - الواجهة الخلفية)

1.  **المعالجة الآلية للبيانات الجغرافية:**
    *   تستقبل الواجهة الخلفية البيانات المرفوعة من تطبيق المساح.
    *   **التوليد التلقائي للمعالم:** بناءً على الأكواد الذكية، يقوم النظام تلقائياً بتوليد الأشكال الهندسية (مضلعات، خطوط) في قاعدة بيانات PostGIS.
    *   **حساب الاتجاهات الذكي:** لكل ضلع في المضلع أو الخط، يقوم النظام بحساب:
        *   **الاتجاه الرئيسي (4 اتجاهات):** يحدد ما إذا كان الضلع يميل بشكل أساسي نحو الشمال، الجنوب، الشرق، أو الغرب. (مثال: أي زاوية بين 45 و 135 درجة تعتبر "شمالية" بشكل أساسي).
        *   **الاتجاه الثانوي (8 اتجاهات):** يحدد الاتجاه الدقيق (شمال شرق، جنوب غرب، إلخ).
    *   **حساب المساحات والأطوال:** يتم حساب المساحة الإجمالية للمضلعات وأطوال الأضلاع بدقة.
2.  **مراجعة البيانات الفنية (واجهة الويب للموظف):**
    *   يتلقى المراجع الفني إشعاراً باكتمال الرفع المساحي.
    *   يستخدم واجهة الويب لعرض البيانات المرفوعة على خريطة تفاعلية، ومراجعة الأشكال الهندسية، الأطوال، المساحات، والاتجاهات المحسوبة تلقائياً.
    *   يمكنه إضافة ملاحظات أو طلب تعديلات من المساح إذا لزم الأمر.
3.  **الموافقة النهائية وإصدار القرار:**
    *   بعد المراجعة الفنية، يقوم الموظف المختص (المدير) بالموافقة النهائية على البيانات.
    *   يقوم النظام تلقائياً بتوليد "القرار المساحي" كملف PDF معتمد، يتضمن:
        *   بيانات المالك والعقار.
        *   رسم توضيحي لقطعة الأرض مع الأبعاد والاتجاهات.
        *   جدول إحداثيات النقاط.
        *   المساحة الإجمالية.
        *   رقم القرار المساحي الفريد والباركود.
4.  **إشعار المواطن:** يتم إرسال إشعار للمواطن/المكتب الهندسي بأن القرار المساحي قد صدر، ويمكنه تنزيله من بوابة المواطن.



## 3. إدارة المستخدمين والصلاحيات لخدمة القرار المساحي

تعتبر إدارة المستخدمين والصلاحيات حاسمة لضمان أمن وسلامة البيانات والعمليات في خدمة القرار المساحي. سيتم تطبيق نظام صلاحيات دقيق يحدد ما يمكن لكل مستخدم القيام به والوصول إليه، وذلك ضمن إطار نظام إدارة المستخدمين والأدوار والصلاحيات الشامل للمنصة [1].

### 3.1. الأدوار الرئيسية وتفاعلها مع الخدمة

*   **المواطن/المستثمر:** يمكنه تقديم طلبات القرار المساحي، تتبع حالتها، وتنزيل القرارات الصادرة التي تخصه.
*   **المكتب الهندسي:** يمكنه تقديم طلبات نيابة عن المالكين، تتبع الطلبات، وتنزيل القرارات. لديه صلاحيات أوسع في إدارة طلبات متعددة.
*   **المساح الميداني:** يمكنه استلام التكليفات، إجراء الرفع المساحي باستخدام تطبيق المفتش المساحي، ومزامنة البيانات. لا يمكنه تعديل بيانات الطلب الأساسية أو إصدار القرار.
*   **المراجع الفني (مكتب الأشغال):** يمكنه مراجعة البيانات المساحية المرفوعة، إضافة ملاحظات، وطلب تعديلات. لديه صلاحية الوصول إلى جميع الطلبات في نطاق مسؤوليته.
*   **المدير (مكتب الأشغال):** لديه صلاحية الموافقة النهائية على القرارات المساحية، تعيين المساحين، ومراقبة سير العمل.
*   **مسؤول النظام:** لديه صلاحيات كاملة لإدارة المستخدمين، الأدوار، الأكواد، وإعدادات النظام.

### 3.2. آليات تطبيق الصلاحيات

*   **على مستوى الواجهة الخلفية (API):** يتم التحقق من صلاحيات المستخدم لكل نقطة نهاية (Endpoint) قبل تنفيذ أي عملية. (مثال: لا يمكن للمواطن استدعاء API إصدار القرار المساحي).
*   **على مستوى الواجهة الأمامية (UI):** يتم إخفاء أو تعطيل الأزرار والعناصر التي لا يملك المستخدم صلاحية الوصول إليها.
*   **سجل التدقيق (Audit Log):** يتم تسجيل جميع الإجراءات الهامة التي يقوم بها المستخدمون (مثل: تقديم طلب، رفع بيانات، موافقة، إصدار قرار) مع ختم الوقت واسم المستخدم، وذلك ضمن سجل التدقيق العام للمنصة [1].

[1] دليل التطوير الشامل لمنصة "بنّاء اليمن" الرقمية (الإصدار 2.0)، قسم 2.1.1.



## 4. التكامل التقني: بناء خدمة القرار المساحي

تتطلب خدمة القرار المساحي بنية تقنية قوية ومتكاملة لضمان الأداء، الدقة، وقابلية التوسع. سيتم بناء هذه الخدمة بالاستفادة من البنية التحتية الحالية لمنصة "بنّاء اليمن"، مع تطوير مكونات جديدة تلبي المتطلبات الخاصة بالمسح الجغرافي.

### 4.1. الواجهة الخلفية (Backend - Flask/Python)

ستكون الواجهة الخلفية هي العقل المدبر لخدمة القرار المساحي، حيث تعالج البيانات، تدير سير العمل، وتوفر نقاط النهاية (APIs) اللازمة للتفاعل مع الواجهات الأمامية.

*   **نقطة نهاية رفع ملفات SHP/ZIP:**
    *   **الوصف:** تطوير نقطة نهاية API مخصصة (مثال: `/api/v1/survey/upload_shp`) لاستقبال ملفات `Shapefile` أو ملفات `ZIP` التي تحتوي على `Shapefile` من تطبيق المفتش المساحي أو واجهة الويب. هذه النقطة ستكون مسؤولة عن التحقق الأولي من الملفات واستخراج البيانات الجغرافية منها.
    *   **التكامل:** ستتكامل هذه النقطة مع وحدة معالجة البيانات الجغرافية (Geoprocessing Module) لتحليل المحتوى الهندسي للملفات.
*   **معالجة البيانات الجغرافية (Geoprocessing Module):**
    *   **الوصف:** هذه الوحدة هي جوهر المعالجة المساحية. ستكون مسؤولة عن:
        *   **قراءة وتحليل SHP:** استخدام مكتبات Python متخصصة مثل `GeoPandas` و `Shapely` لقراءة وتحليل الأشكال الهندسية (نقاط، خطوط، مضلعات) من ملفات `Shapefile`.
        *   **تحويل الإحداثيات:** ضمان أن جميع الإحداثيات يتم تحويلها إلى نظام إسقاط موحد (مثال: UTM) لإجراء حسابات دقيقة، باستخدام مكتبات مثل `pyproj`.
        *   **حساب المسافات والزوايا:** حساب أطوال الأضلاع والزوايا الداخلية للمضلعات بدقة متناهية.
        *   **تصنيف الاتجاهات الذكي:** تطبيق خوارزميات لتصنيف اتجاهات الأضلاع إلى:
            *   **الاتجاه الرئيسي (4 اتجاهات):** شمال، جنوب، شرق، غرب. يتم تحديد الاتجاه بناءً على الزاوية (مثال: 45-135 درجة للشمال، 135-225 للغرب، وهكذا).
            *   **الاتجاه الثانوي (8 اتجاهات):** شمال شرق، شمال غرب، جنوب شرق، جنوب غرب، لتوفير تفصيل أكبر.
        *   **حساب المساحات:** حساب المساحة الإجمالية للمضلعات بدقة.
        *   **التحقق الطوبولوجي (Topological Validation):** إجراء فحوصات تلقائية لضمان صحة الأشكال الهندسية (مثال: إغلاق المضلعات، عدم وجود تقاطعات ذاتية).
    *   **التكامل:** ستتفاعل هذه الوحدة بشكل مباشر مع قاعدة بيانات PostGIS لتخزين الأشكال الهندسية والبيانات الوصفية المحسوبة.
*   **محرك سير العمل (Workflow Engine):**
    *   **الوصف:** تحديث محرك سير العمل العام للمنصة [1] لدعم الحالات الخاصة بخدمة القرار المساحي. هذا يشمل حالات مثل: `جديد` -> `قيد المراجعة الأولية` -> `تم التكليف` -> `قيد الرفع الميداني` -> `تم الرفع الميداني` -> `قيد المراجعة الفنية` -> `جاهز للإصدار` -> `صادر` -> `مرفوض`.
    *   **التكامل:** سيتم إرسال إشعارات تلقائية (عبر البريد الإلكتروني وداخل التطبيق) للمستخدمين والموظفين عند كل تغيير في حالة الطلب.
*   **نظام الإشعارات:**
    *   **الوصف:** تعزيز نظام الإشعارات الحالي [1] لدعم الإشعارات الفورية المتعلقة بحالة طلب القرار المساحي، مثل إشعار المساح بتكليف جديد، أو إشعار المواطن بصدور القرار.

### 4.2. الواجهة الأمامية (Frontend - React/React Native)

ستوفر الواجهات الأمامية تجربة مستخدم سلسة وتفاعلية لجميع الأطراف المعنية.

*   **بوابة المواطن/المكتب الهندسي (React Web Application):**
    *   **نماذج تقديم الطلبات التفاعلية:** واجهة سهلة الاستخدام لتقديم طلب القرار المساحي، مع حقول ديناميكية للبيانات الأساسية والمرفقات.
    *   **لوحة تحكم لتتبع حالة الطلبات:** عرض واضح لحالة الطلب الحالية، مع سجل زمني للإجراءات المتخذة.
    *   **واجهة لتنزيل القرارات المساحية الصادرة:** تمكين المستخدم من تنزيل ملف PDF للقرار المساحي بعد صدوره.
*   **تطبيق المفتش المساحي (React Native Mobile Application):**
    *   **واجهة تسجيل دخول آمنة:** تتكامل مع نظام المصادقة المركزي للمنصة.
    *   **شاشة خريطة تفاعلية:** تعرض الموقع الحالي للمساح، النقاط المرفوعة، والأشكال الهندسية التي يتم رسمها في الوقت الفعلي. ستستخدم مكتبات خرائط مثل `react-native-maps` أو `Mapbox GL JS`.
    *   **شريط أدوات ذكي (Smart Toolbar):** يوفر أزرارًا لاختيار نوع المعلم (نقطة، خط، مضلع) ويعرض قائمة بأكواد التكويد المفلترة ديناميكيًا.
    *   **واجهة اتصال بجهاز GNSS:** تتيح الاتصال بأجهزة GNSS عبر البلوتوث، وتعرض حالة الاتصال، دقة الإحداثيات (HDOP, VDOP)، ونوع الحل (RTK Fixed, Float, Autonomous).
    *   **دعم العمل دون اتصال بالإنترنت (Offline Capability):** تخزين البيانات المرفوعة محليًا ومزامنتها تلقائيًا مع الخادم عند استعادة الاتصال بالإنترنت، لضمان استمرارية العمل الميداني في المناطق ذات التغطية الضعيفة.
    *   **إدارة المرفقات:** إمكانية التقاط الصور وإرفاقها بالمعالم المرفوعة.
*   **واجهة الويب لموظفي مكتب الأشغال (React Web Application):**
    *   **لوحة تحكم لإدارة طلبات القرار المساحي:** عرض جميع الطلبات، البحث، التصفية، وتغيير الحالات.
    *   **واجهة مراجعة فنية:** تعرض البيانات الجغرافية للطلب على خريطة تفاعلية، مع تفاصيل الأبعاد، الاتجاهات، والمساحات المحسوبة. يمكن للمراجع إضافة ملاحظات مباشرة على الخريطة أو في حقول نصية.
        *   **أدوات الرسم المتكاملة للموظف:**
            *   **عرض صور وحدات الجوار المرجعية:** تحميل وعرض صور وحدات الجوار المرجعية (التي تم رقمنتها في القسم 5) كطبقات خلفية شفافة على الخريطة التفاعلية، مع إمكانية ضبط شفافيتها وإسنادها الجغرافي.
            *   **أدوات رسم الشوارع:** توفير أدوات رسم دقيقة (Polyline Tool) للموظف لرسم خطوط الشوارع أو تعديلها بناءً على الصورة المرجعية لوحدة الجوار أو خرائط الأساس. هذه الأدوات ستدعم:
                *   **الرسم الحر:** لرسم خطوط الشوارع يدويًا.
                *   **التحرير المتقدم:** تعديل النقاط (Vertices)، إضافة/حذف نقاط، تقسيم/دمج الخطوط.
                *   **الربط الذكي (Snapping):** لضمان اتصال دقيق لخطوط الشوارع مع بعضها البعض أو مع حدود قطع الأراضي.
            *   **أدوات تحليل المساحات (بناءً على خط الشارع):** بمجرد رسم خط الشارع أو تحديده، يقوم النظام تلقائيًا بإجراء التحليلات التالية على قطعة الأرض المرفوعة:
                *   **تحديد المساحة السليمة:** يقوم النظام بحساب المساحة "السليمة" لقطعة الأرض، وهي الجزء الذي يقع ضمن حدود التخطيط العمراني ولا يتعارض مع خط الشارع الجديد أو المعتمد.
                *   **تحديد المساحة المخالفة/المرتدة:** يقوم النظام بحساب المساحة "المخالفة" أو "المرتدة"، وهي الجزء من قطعة الأرض الذي يقع ضمن حرم الشارع المخطط له أو الارتداد المطلوب، والذي يجب إزالته أو عدم البناء عليه. يتم توضيح هذه المساحة بصريًا على الخريطة.
                *   **توضيح المساحة المتبقية:** عرض المساحة المتبقية من قطعة الأرض بعد استبعاد المساحة المخالفة.
                *   **توليد مضلع القطعة السليمة:** يتم توليد مضلع جديد يمثل الشكل الهندسي لقطعة الأرض بعد استبعاد المساحة المخالفة، وهو المضلع الذي سيتم اعتماده في القرار المساحي.
        *   **إصدار القرار المساحي وملحقاته:**
            *   **توليد القرار المساحي للقطعة السليمة:** يتم توليد القرار المساحي تلقائيًا بناءً على مضلع القطعة السليمة المحسوب.
            *   **ملحق القرار المساحي (تقرير المساحات المخالفة/المرتدة):** يتم توليد ملحق PDF للقرار المساحي يوضح بشكل تفصيلي:
                *   المساحة المخالفة/المرتدة (بالأرقام والرسوم التوضيحية).
                *   المسافة المتبقية للوصول إلى حد الشارع (إن وجدت).
                *   أي تفاصيل أخرى ذات صلة بالارتدادات أو التخطيط.
            *   **أدوات الموافقة/الرفض:** أزرار واضحة للموافقة على الطلب أو رفضه مع إمكانية إضافة أسباب الرفض وطلب التعديلات من المساح.

### 4.3. قاعدة البيانات (PostgreSQL/PostGIS)

ستكون قاعدة البيانات هي المستودع المركزي لجميع البيانات المتعلقة بخدمة القرار المساحي، مع الاستفادة القصوى من إمكانيات PostGIS لتخزين ومعالجة البيانات الجغرافية.

*   **جداول الطلبات (`permits.survey_requests`):**
    *   **الوصف:** تخزين جميع البيانات الوصفية لطلبات القرار المساحي، مثل بيانات المالك، العقار، الغرض، حالة الطلب، وتاريخ التقديم.
    *   **التكامل:** سترتبط هذه الجداول بالجداول الجغرافية عبر مفاتيح خارجية.
*   **جداول البيانات الجغرافية (`gis.surveyed_points`, `gis.feature_geometry`):**
    *   `gis.surveyed_points`:
        *   **الوصف:** لتخزين النقاط الخام المرفوعة من الميدان بواسطة جهاز GNSS. كل سجل سيحتوي على إحداثيات النقطة (X, Y, Z)، كود المعلم، وقت الرفع، ودقة الرفع.
        *   **الحقول الأساسية:** `id`, `request_id` (FK), `point_geometry` (GEOMETRY(Point, 4326)), `feature_code_id` (FK), `timestamp`, `accuracy_h`, `accuracy_v`.
    *   `gis.feature_geometry`:
        *   **الوصف:** لتخزين الأشكال الهندسية النهائية (خطوط، مضلعات) التي تم توليدها ومعالجتها من النقاط المرفوعة. هذا الجدول سيمثل "القرار المساحي" الهندسي.
        *   **الحقول الأساسية:** `id`, `survey_request_id` (FK), `geometry` (GEOMETRY(Polygon/LineString, 4326)), `area_sqm`, `perimeter_m`, `attributes` (JSONB for dimensions, bearings, etc.).
*   **جداول الأكواد المرجعية (`gis.feature_codes`):**
    *   **الوصف:** جدول مرجعي يحتوي على جميع أكواد المعالم المعتمدة (نقاط، خطوط، مضلعات) التي يستخدمها المساحون في الميدان. هذا يضمن توحيد البيانات.
    *   **الحقول الأساسية:** `id`, `code`, `description_ar`, `description_en`, `geometry_type` (Point, Line, Polygon).
*   **جداول الصلاحيات:** كما هو موضح في القسم 3.2، سيتم استخدام جداول الصلاحيات المركزية للمنصة [1].

### 4.4. التكامل مع أجهزة GNSS (مثال: Stonex، Trimble)

*   **بروتوكول الاتصال:** سيتم استخدام بروتوكولات الاتصال القياسية مثل Bluetooth SPP (Serial Port Profile) أو TCP/IP للاتصال بأجهزة GNSS. يجب أن يدعم التطبيق بروتوكولات NMEA (National Marine Electronics Association) لاستقبال بيانات الموقع والوقت والدقة.
*   **استقبال البيانات:** سيقوم تطبيق المفتش المساحي باستقبال تدفق البيانات الخام (NMEA sentences) من جهاز GNSS، وتحليلها لاستخلاص إحداثيات الموقع (خط الطول، خط العرض، الارتفاع)، دقة الإحداثيات، ونوع الحل (RTK Fixed, Float, Autonomous).
*   **معالجة الإحداثيات:** تحويل الإحداثيات المستلمة إلى نظام الإحداثيات المحلي (UTM) وعرضها على الخريطة في الوقت الفعلي، مع تحديث مستمر لمؤشرات الدقة للمساح.
*   **إدارة الدقة:** عرض مؤشرات دقة الإحداثيات (مثل HDOP - Horizontal Dilution of Precision, VDOP - Vertical Dilution of Precision) بشكل واضح للمساح، مع إمكانية ضبط عتبات للدقة المقبولة قبل تسجيل النقطة.

[1] دليل التطوير الشامل لمنصة "بنّاء اليمن" الرقمية (الإصدار 2.0)، قسم 2.1.1.



## 5. رقمنة الأصول الحضرية: وحدات الجوار (Neighborhood Units) وتخطيط الشوارع

تُعد رقمنة وحدات الجوار وتخطيط الشوارع خطوة استراتيجية نحو بناء قاعدة بيانات جغرافية مكانية شاملة ودقيقة لليمن، تتجاوز مجرد تسجيل قطع الأراضي الفردية. هذه العملية ستدعم التخطيط العمراني المستقبلي، وتوفر سياقًا مكانيًا حيويًا للقرارات المساحية، خاصة في المناطق غير المخططة أو التي تعتمد على خرائط ورقية قديمة. سيتم دمج هذه الوظائف ضمن منصة "بنّاء اليمن" لتمكين موظفي الأشغال من تحويل البيانات التخطيطية التقليدية إلى أصول رقمية قابلة للتحليل.

### 5.1. جدول بيانات وحدات الجوار (`gis.neighborhood_units`)

سيتم إنشاء جدول بيانات مخصص لوحدات الجوار في قاعدة بيانات PostGIS، يحتوي على المعلومات الأساسية لكل وحدة جوار، بالإضافة إلى بياناتها الجغرافية (مضلع). هذا الجدول سيتكامل مع الجداول الإدارية للمدن والمديريات [1].

| اسم الحقل (Field Name) | نوع البيانات (Data Type) | الوصف (Description)                                     | ملاحظات                                                                                                 |
| :-------------------- | :---------------------- | :------------------------------------------------------ | :------------------------------------------------------------------------------------------------------- |
| `id`                  | `SERIAL`                | معرف فريد لوحدة الجوار (Primary Key)                    |                                                                                                          |
| `name_ar`             | `VARCHAR(255)`          | اسم وحدة الجوار باللغة العربية                          |                                                                                                          |
| `name_en`             | `VARCHAR(255)`          | اسم وحدة الجوار باللغة الإنجليزية (اختياري)            |                                                                                                          |
| `city_id`             | `INTEGER`               | معرف المدينة التي تتبع لها وحدة الجوار (Foreign Key)    | يرتبط بجدول `core.cities`                                                                                |
| `district_id`         | `INTEGER`               | معرف المديرية التي تتبع لها وحدة الجوار (Foreign Key)   | يرتبط بجدول `core.districts`                                                                             |
| `area_sqm`            | `NUMERIC`               | مساحة وحدة الجوار بالمتر المربع (محسوبة تلقائياً)       | يتم حسابها بواسطة PostGIS عند إدخال الشكل الهندسي                                                      |
| `population`          | `INTEGER`               | عدد السكان التقديري لوحدة الجوار (اختياري)              |                                                                                                          |
| `geom`                | `GEOMETRY(Polygon, 4326)` | الشكل الهندسي لوحدة الجوار (مضلع)                       | يتم تخزينه بنظام الإحداثيات الجغرافية WGS84 (EPSG:4326)                                                 |
| `raster_image_path`   | `VARCHAR(512)`          | مسار تخزين الصورة المرجعية لوحدة الجوار (إن وجدت)       | يستخدم كخلفية للمراجعة البصرية                                                                           |
| `georef_data`         | `JSONB`                 | بيانات الإسناد الجغرافي للصورة المرجعية (نقاط التحكم)   | لتخزين نقاط التحكم الأرضية (GCPs) ونظام الإحداثيات المستخدم للصورة                                      |
| `digitization_status` | `VARCHAR(50)`           | حالة رقمنة الشوارع داخل الوحدة                          | `Not Started`, `In Progress`, `Completed`                                                                |
| `created_by`          | `INTEGER`               | معرف المستخدم الذي أضاف الوحدة (Foreign Key)            | يرتبط بجدول `core.users`                                                                                 |
| `created_at`          | `TIMESTAMP`             | تاريخ ووقت إنشاء السجل                                  |                                                                                                          |
| `updated_at`          | `TIMESTAMP`             | تاريخ ووقت آخر تحديث للسجل                              |                                                                                                          |

### 5.2. أدوات رسم حدود الشارع وإدخال البيانات

سيتم تطوير أدوات متقدمة ضمن واجهة الويب لموظفي مكتب الأشغال (أو تطبيق متخصص) لرقمنة حدود الشوارع بناءً على صور وحدات الجوار المرجعية أو الخرائط الأساسية. هذه الأدوات ستكون جزءًا من وحدة إدارة البيانات الجغرافية في الواجهة الخلفية [2].

#### 5.2.1. واجهة المستخدم (UI) لأدوات رسم الشوارع

*   **عرض الخريطة الأساسية:** سيتم عرض خريطة تفاعلية (باستخدام مكتبات مثل Leaflet أو OpenLayers) ضمن لوحة تحكم الموظفين. ستدعم هذه الخريطة طبقات متعددة، بما في ذلك:
    *   **صور الأقمار الصناعية:** كخلفية مرجعية حديثة.
    *   **صور وحدات الجوار المرجعية:** يتم تحميلها كطبقات شفافة قابلة للتعديل، مع إمكانية تطبيق بيانات الإسناد الجغرافي المخزنة في جدول `gis.neighborhood_units`.
    *   **طبقات البيانات الجغرافية الحالية:** لعرض قطع الأراضي والمنشآت الموجودة.
*   **أدوات الرسم المتقدمة:** سيتم توفير مجموعة من أدوات الرسم البديهية لإنشاء خطوط تمثل محاور الشوارع أو حدودها:
    *   **أداة رسم الخط (Polyline Tool):** للسماح للمستخدم برسم خطوط متصلة تمثل مسار الشارع. ستدعم هذه الأداة إضافة النقاط (Vertices) وحذفها وتعديلها بسهولة.
    *   **أداة التعديل (Edit Tool):** لتمكين المستخدم من تعديل النقاط على الخطوط الموجودة، أو إضافة نقاط جديدة، أو حذف نقاط غير مرغوب فيها، مما يتيح التحكم الدقيق في شكل الشارع.
    *   **أداة الربط (Snapping Tool):** لضمان اتصال دقيق بين خطوط الشوارع عند التقاطعات أو عند الربط بنقاط أو خطوط موجودة مسبقًا (مثل حدود قطع الأراضي). هذا يضمن سلامة البيانات الطوبولوجية لشبكة الشوارع.
    *   **أداة تقسيم الخط (Split Line Tool):** لتقسيم خط شارع طويل إلى أجزاء أصغر عند التقاطعات أو عند تغير خصائص الشارع.
    *   **أداة دمج الخطوط (Merge Lines Tool):** لدمج خطوط شوارع متجاورة في خط واحد.
*   **نموذج إدخال بيانات الشارع:** عند الانتهاء من رسم خط الشارع، سيظهر نموذج منبثق (Modal Form) لإدخال البيانات الوصفية المرتبطة به. هذه البيانات ستُخزن في جدول `gis.streets`.

#### 5.2.2. جدول بيانات الشوارع (`gis.streets`)

| اسم الحقل (Field Name) | نوع البيانات (Data Type) | الوصف (Description)                                     | ملاحظات                                                                                                 |
| :-------------------- | :---------------------- | :------------------------------------------------------ | :------------------------------------------------------------------------------------------------------- |
| `id`                  | `SERIAL`                | معرف فريد للشارع (Primary Key)                         |                                                                                                          |
| `name_ar`             | `VARCHAR(255)`          | اسم الشارع باللغة العربية                               |
| `name_en`             | `VARCHAR(255)`          | اسم الشارع باللغة الإنجليزية (اختياري)                 |
| `street_type`         | `VARCHAR(50)`           | نوع الشارع (مثال: رئيسي، فرعي، زقاق، نافذ، غير نافذ)   | قائمة قيم محددة (ENUM)                                                                                   |
| `width_meters`        | `NUMERIC`               | عرض الشارع المقدر بالمتر                                | يمكن أن يكون تقديرًا مبدئيًا أو قيمة دقيقة إذا كانت متوفرة                                               |
| `neighborhood_unit_id`| `INTEGER`               | معرف وحدة الجوار التي يقع فيها الشارع (Foreign Key)    | يرتبط بجدول `gis.neighborhood_units`                                                                     |
| `geom`                | `GEOMETRY(LineString, 4326)` | الشكل الهندسي للشارع (خط)                               | يمثل الخط المركزي للشارع أو أحد حدوده                                                                    |
| `is_digitized`        | `BOOLEAN`               | هل تم رقمنة الشارع يدوياً؟                              | `TRUE` إذا تم رسمه باستخدام الأدوات، `FALSE` إذا كان مستوردًا من مصدر آخر                               |
| `source_map_path`     | `VARCHAR(512)`          | مسار الصورة/الخريطة التي تم الاعتماد عليها في الرقمنة   | لتتبع مصدر البيانات                                                                                      |
| `created_by`          | `INTEGER`               | معرف المستخدم الذي قام بالرقمنة (Foreign Key)           | يرتبط بجدول `core.users`                                                                                 |
| `created_at`          | `TIMESTAMP`             | تاريخ ووقت إنشاء السجل                                  |                                                                                                          |
| `updated_at`          | `TIMESTAMP`             | تاريخ ووقت آخر تحديث للسجل                              |                                                                                                          |

### 5.3. التكامل التقني لأدوات الرقمنة

*   **الواجهة الأمامية (Frontend):**
    *   استخدام مكتبات خرائط متقدمة مثل **Leaflet** أو **OpenLayers** كقاعدة للخريطة التفاعلية.
    *   تضمين إضافات الرسم الخاصة بهذه المكتبات (مثل `Leaflet.draw` أو `OpenLayers.interaction.Draw`) لتوفير أدوات الرسم والتعديل.
    *   تطوير مكونات React مخصصة لتغليف أدوات الرسم ونماذج إدخال البيانات، وضمان تجربة مستخدم متناسقة مع بقية المنصة.
*   **الواجهة الخلفية (Backend):**
    *   إنشاء نقاط نهاية (APIs) مخصصة لاستقبال وحفظ البيانات الجغرافية لوحدات الجوار والشوارع بصيغة GeoJSON.
    *   تطبيق قواعد تحقق من الصحة الطوبولوجية (Topological Validation) على مستوى الخادم باستخدام PostGIS لضمان عدم وجود أخطاء هندسية (مثل التقاطعات الذاتية، الفجوات) في البيانات المدخلة.
    *   تطوير وظائف PostGIS لحساب المساحات والأطوال تلقائيًا عند إدخال الأشكال الهندسية.
    *   إدارة إصدارات البيانات (Versioning) لتمكين التراجع عن التغييرات وتتبع تاريخ التعديلات على البيانات الجغرافية.

[1] دليل التطوير الشامل لمنصة "بنّاء اليمن" الرقمية (الإصدار 2.0)، قسم 2.1.1.
[2] دليل التطوير الشامل لمنصة "بنّاء اليمن" الرقمية (الإصدار 2.0)، قسم 2.1.1.



## 6. المخرجات الاستراتيجية والتأثير على المنصة

تطوير خدمة القرار المساحي بهذا المستوى من التكامل والذكاء سيحقق مجموعة من المخرجات الاستراتيجية التي ستعزز من قيمة منصة "بنّاء اليمن" وتأثيرها على التنمية الحضرية.

1.  **نظام قرار مساحي آلي بالكامل:** سيتم تقليص زمن إنجاز خدمة القرار المساحي بشكل جذري، مما يقلل من البيروقراطية ويسرع من عجلة التنمية العمرانية.
2.  **قاعدة بيانات جغرافية مركزية موثوقة:** ستصبح البيانات المساحية التي يتم جمعها ومعالجتها أصلاً وطنياً حيوياً، يمكن الاعتماد عليه في التخطيط العمراني، إدارة الأراضي، واتخاذ القرارات الحكومية.
3.  **رقمنة الأصول الحضرية غير المخططة:** ستتحول الصور والمخططات الورقية القديمة لوحدات الجوار والشوارع إلى بيانات مكانية حية وقابلة للتحليل، مما يفتح آفاقاً جديدة للتخطيط والتطوير في المناطق العشوائية أو غير المنظمة.
4.  **تعزيز الامتثال لقانون البناء:** من خلال ربط القرارات المساحية مباشرة ببيانات الشوارع والارتدادات المطلوبة، سيتم تعزيز الامتثال للوائح البناء وتقليل المخالفات.
5.  **تحسين تجربة المستخدم:** ستوفر الخدمة تجربة سلسة وشفافة للمواطنين والمكاتب الهندسية، مما يعزز الثقة في الخدمات الحكومية الرقمية.
6.  **دعم اتخاذ القرار:** ستوفر البيانات الجغرافية الدقيقة والمحدثة أساساً قوياً لتحليلات نظم المعلومات الجغرافية (GIS) التي تدعم صناع القرار في التخطيط العمراني وإدارة الموارد.




## 7. المراجع

[1] دليل التطوير الشامل لمنصة "بنّاء اليمن" الرقمية (الإصدار 2.0). (مرفق سابقاً)
[2] الأتمتة والدقة في الخدمات الحكومية الرقمية. (مرجع افتراضي)
[3] أهمية GNSS في المسح العقاري الحديث. (مرجع افتراضي)
[4] تحسين الكفاءة التشغيلية في القطاع العام. (مرجع افتراضي)
[5] بناء قواعد البيانات الجغرافية الوطنية. (مرجع افتراضي)
[6] قانون البناء اليمني رقم (19) لسنة 2002م ولائحته التنفيذية. (مرجع افتراضي)


